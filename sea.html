<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VELOCIS‚Ñ¢ Sea Gate Authority</title>
    <style>
        body { margin: 0; background: #010406; overflow: hidden; font-family: 'Courier New', monospace; width: 100vw; height: 100vh; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }
        #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2; }
        #header-box { 
            position: absolute; top: 20px; left: 5%; width: 90%; 
            border: 2px solid #FFD700; padding: 10px; background: rgba(0,20,20,0.9); 
            box-sizing: border-box; transition: all 0.5s ease;
        }
        #brand-title { color: #FFD700; font-size: 14px; font-weight: 900; }
        #clock { color: #FFD700; font-size: 20px; font-weight: bold; }
        
        #arrival-modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; background: rgba(0, 70, 180, 0.96); backdrop-filter: blur(20px);
            color: white; padding: 25px; border-radius: 15px; border: 2px solid #fff;
            z-index: 20000; text-align: center; box-shadow: 0 0 50px rgba(0, 110, 255, 0.5);
            pointer-events: auto !important;
        }
        .transport-btn {
            display: block; background: #00ffff; color: #000; font-weight: 900;
            padding: 15px; border-radius: 8px; text-decoration: none; margin: 20px 0 10px 0;
            font-size: 13px; text-transform: uppercase; letter-spacing: 1px; width: 100%; border: none;
        }
        #transport-menu { position: fixed; bottom: 65px; left: 50%; transform: translateX(-50%); display: flex; justify-content: center; gap: 10px; width: 98%; z-index: 10000; pointer-events: auto; }
        .icon-btn { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border: 2px solid rgba(0, 255, 255, 0.3); border-radius: 50%; background: rgba(0, 255, 255, 0.1); font-size: 1.4rem; cursor: pointer; color: white; text-decoration: none;}
        .icon-btn.active { border-color: #00ffff; background: rgba(0,255,255,0.25); transform: scale(1.1) translateY(-3px); box-shadow: 0 0 15px #00ffff; }

        /* COMPASS UI STYLES */
        #compass-container {
            position: absolute; top: 120px; right: 20px; width: 60px; height: 60px;
            border: 2px solid #00ffff; border-radius: 50%; background: rgba(0,0,0,0.5);
            display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        #compass-needle {
            width: 4px; height: 40px; background: #39FF14; border-radius: 2px;
            transition: transform 0.1s ease-out; box-shadow: 0 0 10px #39FF14;
        }

        @keyframes alertBoxPulse { 0% { border-width: 2px; box-shadow: 0 0 5px #FF3131; transform: scale(1); } 50% { border-width: 6px; box-shadow: 0 0 25px #FF3131; transform: scale(1.02); } 100% { border-width: 2px; box-shadow: 0 0 5px #FF3131; transform: scale(1); } }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .ticker-wrap { position: absolute; bottom: 0; width: 100%; height: 50px; background: rgba(60, 0, 0, 0.95); border-top: 4px solid #FF3131; display: flex; align-items: center; overflow: hidden; z-index: 10001; }
    </style>
</head>
<body>
    <canvas id="engine"></canvas>
    <div id="ui">
        <div id="header-box">
            <div id="brand-title">VELOCIS‚Ñ¢ SEA COMMAND</div>
            <div style="height: 2px; background: #FFD700; margin: 8px 0;"></div>
            <div id="clock">TIME: --:--:--</div>
        </div>

        <div id="compass-container">
            <div id="compass-needle"></div>
            <div style="position:absolute; font-size:8px; bottom:-15px; color:#00ffff; white-space:nowrap;">VESSEL LOCK</div>
        </div>

        <div id="arrival-modal">
            <h2 id="mission-status" style="margin: 0; text-transform: uppercase;">VESSEL DATA PENDING</h2>
            <div style="margin: 15px 0;">
                <input type="text" id="vessel-query" placeholder="OPTIONAL: MANUAL VOYAGE #" 
                       oninput="if(this.value.length >= 4) fetchVesselData()"
                       style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #00ffff; background: #000; color: #00ffff; font-weight: 900; text-align: center; text-transform: uppercase; outline: none; box-sizing: border-box;">
            </div>
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); margin: 15px 0;">
                <p id="dock-info" style="margin: 0; font-weight: 900; font-size: 1.8rem;">PIER LOGISTICS</p>
                <p id="port-status-text" style="margin: 5px 0 0 0; font-size: 0.9rem; color: #00ffff; font-weight: bold; letter-spacing: 1px; text-transform: uppercase;">
                    SYSTEM IS SCANNING. DOCK AND PIER DATA WILL AUTOMATICALLY POPULATE IN THIS WINDOW.
                </p>
            </div>
<button onclick="window.location.href='index.html#ground-transport-market'" 
        style="display: block; background: #00ffff; color: #000; font-weight: 900; padding: 15px; border-radius: 8px; text-decoration: none; margin: 20px 0 10px 0; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; width: 100%; border: none; cursor: pointer; font-family: 'Courier New', monospace; box-shadow: 0 4px 15px rgba(0, 255, 255, 0.4);">
    Rentals & Ride-Hailing
</button>
            <button onclick="document.getElementById('arrival-modal').style.display='none'" style="margin-top: 10px; background: none; color: white; border: none; padding: 10px; cursor: pointer; text-decoration: underline; text-transform: uppercase; font-weight: bold;">Dismiss</button>
        </div>

        <div id="transport-menu">
            <a href="index.html" class="icon-btn">‚úàÔ∏è</a>
            <a href="sea.html" class="icon-btn active">üö¢</a>
            <a href="rail.html" class="icon-btn">üöÜ</a>
            <a href="subway.html" class="icon-btn">üöá</a>
            <a href="car.html" class="icon-btn">üöó</a>
        </div>

        <div class="ticker-wrap">
            <div id="ticker-text" style="white-space: nowrap; color: #FF3131; font-weight: 900; font-size: 18px; animation: marquee 12s linear infinite;">
                MARITIME HUB ACTIVE | HK FERRY PIER 7 | CANNES CRUISE TERM | SCANNING DOCKS
            </div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('engine');
    const ctx = canvas.getContext('2d');
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize); resize();

    const gates = [
        { id: "PIER 7", pos: 0.14, status: "ON TIME" }, 
        { id: "DOCK A", pos: 0.38, status: "BOARDING" },
        { id: "PIER 3", pos: 0.62, status: "ON TIME" }, 
        { id: "TERM 1", pos: 0.86, status: "FINAL CALL" }
    ];

    const dots = Array.from({ length: 35 }, () => ({
        x: Math.random() * canvas.width, y: canvas.height + 20, speed: 0.4 + Math.random() * 0.8, targetGate: Math.floor(Math.random() * gates.length)
    }));

    function drawSleekArrow(x, y, color) {
        ctx.save(); ctx.translate(x, y);
        const pulse = Math.abs(Math.sin(Date.now() / 300)) * 25;
        ctx.shadowBlur = 15 + pulse; ctx.shadowColor = color;
        ctx.fillStyle = color; ctx.beginPath();
        ctx.moveTo(-25, 5); ctx.lineTo(0, -35); ctx.lineTo(25, 5); ctx.lineTo(12, 5); ctx.lineTo(12, 40); ctx.lineTo(-12, 40); ctx.lineTo(-12, 5); ctx.fill();
        ctx.globalAlpha = 0.5; ctx.fillStyle = '#FFFFFF'; ctx.beginPath();
        ctx.moveTo(-25, 5); ctx.lineTo(0, -35); ctx.lineTo(25, 5); ctx.fill();
        ctx.restore();
    }

    function draw() {
        ctx.fillStyle = '#010406'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        const hasFinalCall = gates.some(g => g.status === "FINAL CALL");
        const hb = document.getElementById('header-box');
        const clk = document.getElementById('clock');
        if (hasFinalCall) { hb.style.animation = 'alertBoxPulse 1s infinite ease-in-out'; hb.style.borderColor = '#FF3131'; clk.style.color = '#FF3131'; } 
        else { hb.style.animation = 'none'; hb.style.borderColor = '#FFD700'; clk.style.color = '#FFD700'; }
        
        gates.forEach((g) => {
            const gx = canvas.width * g.pos; const gy = canvas.height * 0.68; 
            let color = (g.status === "ON TIME") ? '#FFD700' : '#FF3131';
            const pGrd = ctx.createLinearGradient(gx-30, 0, gx+30, 0);
            pGrd.addColorStop(0, 'transparent'); pGrd.addColorStop(0.5, 'rgba(0, 212, 255, 0.3)'); pGrd.addColorStop(1, 'transparent');
            ctx.fillStyle = pGrd; ctx.fillRect(gx-30, 0, 60, gy);
            drawSleekArrow(gx, gy + 70 + Math.sin(Date.now()/400)*8, color);
            ctx.textAlign = "center"; ctx.fillStyle = '#FFF'; ctx.font = '900 11px Courier New';
            ctx.fillText("BERTH", gx, gy - 60); 
            ctx.fillStyle = color; ctx.font = '900 16px Courier New';
            ctx.fillText(g.id, gx, gy - 30);
            ctx.font = 'bold 11px monospace'; ctx.fillText(g.status, gx, gy - 12);
        });
        dots.forEach(d => {
            const gx = canvas.width * gates[d.targetGate].pos; const gy = canvas.height * 0.68;
            d.x += (gx - d.x) * 0.015; d.y -= d.speed;
            if (d.y < gy) d.y = canvas.height + 20;
            ctx.fillStyle = '#00FFFF'; ctx.beginPath(); ctx.arc(d.x, d.y, 2, 0, Math.PI*2); ctx.fill();
        });
        requestAnimationFrame(draw);
    }
    draw();

    // VESSEL COMPASS AUTHORITY
    window.addEventListener('deviceorientation', (event) => {
        const needle = document.getElementById('compass-needle');
        if (needle && (event.webkitCompassHeading || event.alpha !== null)) {
            const heading = event.webkitCompassHeading || (360 - event.alpha);
            const vesselBearing = 45; // Fixed simulated ship location
            const needleRotation = vesselBearing - heading;
            needle.style.transform = `rotate(${needleRotation}deg)`;
        }
    });

    let arrivalMinutes = 5;
    let arrivalSeconds = 0;

    function startVesselTracker(portName) {
        document.getElementById('compass-container').style.display = 'flex';
        const timerElement = document.getElementById('port-status-text');
        const countdown = setInterval(() => {
            if (arrivalSeconds === 0) {
                if (arrivalMinutes === 0) {
                    clearInterval(countdown);
                    timerElement.innerText = "VESSEL STATUS: DOCKED ‚Ä¢ SECURE";
                    timerElement.style.color = "#39FF14"; 
                    return;
                }
                arrivalMinutes--;
                arrivalSeconds = 59;
            } else {
                arrivalSeconds--;
            }
            const displaySec = arrivalSeconds < 10 ? '0' + arrivalSeconds : arrivalSeconds;
            timerElement.innerText = `VESSEL ARRIVAL: 0${arrivalMinutes}:${displaySec} | APPROACHING ${portName.toUpperCase()}`;
        }, 1000);
    }

    async function identifyNearestPort(lat, lng) {
        try {
            const query = `[out:json];node["harbour"="yes"](around:10000,${lat},${lng});out;`;
            const response = await fetch('https://overpass-api.de/api/interpreter', { method: 'POST', body: query });
            const data = await response.json();
            
            if (data.elements && data.elements.length > 0) {
                const portName = data.elements[0].tags.name || "ACTIVE HARBOR";
                document.getElementById('mission-status').innerText = "PORT IDENTIFIED";
                document.getElementById('dock-info').innerText = portName.toUpperCase();
                startVesselTracker(portName);
            }
        } catch (e) { console.log("Port scan pending..."); }
    }

    async function fetchVesselData() {
        const inputVal = document.getElementById('vessel-query')?.value;
        const VOYAGE_ID = inputVal ? inputVal.trim().toUpperCase() : 'AUTO_DETECT';
        document.getElementById('mission-status').innerText = `IDENTIFYING ${VOYAGE_ID}...`;
        
        setTimeout(() => {
            if(VOYAGE_ID !== 'AUTO_DETECT') {
                document.getElementById('mission-status').innerText = "VOYAGE IDENTIFIED";
                document.getElementById('dock-info').innerText = "DOCK B / PIER 7";
                document.getElementById('port-status-text').innerText = "REAL-TIME LOGISTICS SECURED";
            } else {
                document.getElementById('mission-status').innerText = "MISSION DATA PENDING";
                document.getElementById('arrival-modal').style.display = 'block';
                navigator.geolocation.getCurrentPosition((pos) => {
                    identifyNearestPort(pos.coords.latitude, pos.coords.longitude);
                }, null, { enableHighAccuracy: true });
            }
        }, 1500);
    }

    setInterval(() => { document.getElementById('clock').innerText = `TIME: ${new Date().toLocaleTimeString('en-GB')}`; }, 1000);
    window.addEventListener('load', () => { setTimeout(fetchVesselData, 1000); });
</script>
</body>
</html>
