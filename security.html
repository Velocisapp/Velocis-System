<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VELOCIS™ | MISSION CONTROL</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        :root { --v-blue: #007AFF; --cyan: #00FBFF; --glass: rgba(255, 255, 255, 0.98); }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: -apple-system, sans-serif; overflow: hidden; background: #000; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }
        .passenger-chevron {
            width: 60px; height: 60px;
            filter: drop-shadow(0px 10px 15px rgba(0, 251, 255, 1));
            display: flex; align-items: center; justify-content: center;
        }
        header { position: absolute; top: 0; width: 100%; height: 64px; background: var(--glass); display: flex; align-items: center; justify-content: space-between; padding: 0 24px; z-index: 10; box-sizing: border-box; }
        #mission-btn { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); padding: 18px 45px; background: var(--v-blue); color: white; border: none; border-radius: 18px; font-weight: 800; font-size: 18px; cursor: pointer; z-index: 100; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
    </style>
</head>
<body>

    <header>
        <div style="font-weight:900; font-size: 20px;">VELOCIS<span style="color:var(--v-blue); font-weight:200;">™</span></div>
        <div style="background:#000; color:#fff; padding:6px 14px; border-radius:20px; font-size:11px; font-weight:900;">A → B MISSION CONTROL</div>
    </header>

    <button id="mission-btn" onclick="startJourney()">CONNECT CURB TO GATE</button>
    <div id="map"></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoidmVsb2Npc2RldmVsb3BlciIsImEiOiJjbWtyanA4NHcxNHk0M2twcXNibXhvdnVhIn0.9sLk_qMET9czvmbYPZ9Bkg';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v11', // The original clean 3D style
            center: [-80.2835, 25.7958], 
            zoom: 18.5, pitch: 45, bearing: 0, antialias: true
        });

        // DEFINING A & B (Common Sense Connection)
        const point_A = [-80.2846, 25.7954]; // THE CURB
        const point_B = [-80.2818, 25.7965]; // THE GATE (D20)
        
        // Manual waypoints through the actual building corridors
        const missionPath = [
            point_A,
            [-80.2838, 25.7957], 
            [-80.2831, 25.7959], 
            [-80.2824, 25.7962], 
            point_B
        ];

        map.on('load', () => {
            // RESTORING 3D TERMINAL: Solid, white, and professional
            map.addLayer({
                'id': 'solid-terminal',
                'source': 'composite', 'source-layer': 'building',
                'type': 'fill-extrusion',
                'paint': {
                    'fill-extrusion-color': '#FFFFFF',
                    'fill-extrusion-height': ['get', 'height'],
                    'fill-extrusion-opacity': 1.0 
                }
            });

            // THE NICE LINE: Cyan thread between A and B
            map.addSource('route', { 'type': 'geojson', 'data': { 'type': 'Feature', 'geometry': { 'type': 'LineString', 'coordinates': missionPath } } });
            map.addLayer({ 'id': 'line', 'type': 'line', 'source': 'route', 'paint': { 'line-color': '#00FBFF', 'line-width': 4 } });
        });

        function startJourney() {
            document.getElementById('mission-btn').style.display = 'none';

            const el = document.createElement('div');
            el.className = 'passenger-chevron';
            el.innerHTML = `<svg width="60" height="60" viewBox="0 0 100 100"><path d="M50 0 L95 100 L50 82 L5 100 Z" fill="#00FBFF" stroke="#000" stroke-width="3"/></svg>`;
            
            const marker = new mapboxgl.Marker({ element: el, rotationAlignment: 'map' })
                .setLngLat(point_A)
                .addTo(map);

            let step = 0;
            function run() {
                if (step < 1) {
                    const i = Math.floor(step * 4);
                    const next = i + 1;
                    const t = (step * 4) - i;
                    const lng = missionPath[i][0] + (missionPath[next][0] - missionPath[i][0]) * t;
                    const lat = missionPath[i][1] + (missionPath[next][1] - missionPath[i][1]) * t;
                    marker.setLngLat([lng, lat]);
                    marker.setRotation(Math.atan2(missionPath[next][0]-missionPath[i][0], missionPath[next][1]-missionPath[i][1])*180/Math.PI);
                    step += 0.002;
                    requestAnimationFrame(run);
                }
            }
            run();
            
            // Over the roof view as requested
            map.flyTo({ center: [-80.2825, 25.7962], zoom: 19.5, pitch: 0, speed: 0.8 });
        }
    </script>
</body>
</html>
