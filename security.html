<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VELOCIS™ | MISSION CONTROL</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        :root { --velocity-blue: #007AFF; --cyan-vibrant: #00FBFF; --glass-white: rgba(255, 255, 255, 0.95); }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: -apple-system, sans-serif; overflow: hidden; background: #F5F5F7; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }
        
        /* Flight Entry Modal */
        #flight-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.4); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            z-index: 100; display: flex; align-items: center; justify-content: center; transition: opacity 0.8s ease;
        }
        .entry-card {
            background: var(--glass-white); padding: 40px; border-radius: 28px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); width: 360px; text-align: center; border: 1px solid rgba(0,0,0,0.05);
        }
        input { width: 100%; padding: 18px; border-radius: 16px; border: 1px solid #E5E5EA; font-size: 22px; text-align: center; margin-bottom: 20px; font-weight: 700; outline: none; }
        button { width: 100%; padding: 18px; background: var(--velocity-blue); color: white; border: none; border-radius: 16px; font-weight: 600; font-size: 17px; cursor: pointer; }

        /* Executive Header */
        header { position: absolute; top: 0; width: 100%; height: 60px; background: var(--glass-white); border-bottom: 1px solid rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; padding: 0 24px; z-index: 10; box-sizing: border-box; }
        #airline-logo { height: 30px; margin-right: 12px; display: none; }
        .mission-info { display: flex; align-items: center; }
    </style>
</head>
<body>

    <div id="flight-overlay">
        <div class="entry-card">
            <h1 style="font-weight:800; letter-spacing:-1px;">VELOCIS<span style="font-weight:300; color:var(--velocity-blue);">™</span></h1>
            <p style="color:#666; font-size: 14px; margin-bottom: 30px;">SECURE MISSION SYNC</p>
            <input type="text" id="flightNum" placeholder="AA 1234" spellcheck="false">
            <button onclick="startMission()">BEGIN JOURNEY</button>
        </div>
    </div>

    <header>
        <div class="mission-info">
            <img id="airline-logo" src="" alt="Airline Logo">
            <div style="font-weight:800; font-size: 18px;">VELOCIS<span style="color:var(--velocity-blue); font-weight:300;">™</span></div>
        </div>
        <div id="status-pill" style="display:none; align-items:center; font-size: 11px; font-weight:700; background: #000; color:#fff; padding: 6px 14px; border-radius: 20px;">
            <span id="active-flight-text">SYNCING...</span>
        </div>
    </header>

    <div id="map"></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoidmVsb2Npc2RldmVsb3BlciIsImEiOiJjbWtyanA4NHcxNHk0M2twcXNibXhvdnVhIn0.9sLk_qMET9czvmbYPZ9Bkg';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [-80.2831, 25.7972],
            zoom: 14, pitch: 0, antialias: true
        });

        const home = [-80.2632, 25.7496];
        const gateD20 = [-80.2818, 25.7960];

        map.on('load', () => {
            // Add 3D Buildings
            map.addLayer({
                'id': '3d-buildings',
                'source': 'composite', 'source-layer': 'building',
                'type': 'fill-extrusion',
                'paint': { 'fill-extrusion-color': '#F2F2F7', 'fill-extrusion-height': ['get', 'height'], 'fill-extrusion-opacity': 0.5 }
            });
        });

        async function startMission() {
            const flight = document.getElementById('flightNum').value.toUpperCase();
            if(!flight) return;

            // 1. Airline Logo Logic
            const logo = document.getElementById('airline-logo');
            if(flight.startsWith('AA')) {
                logo.src = "https://upload.wikimedia.org/wikipedia/en/thumb/3/33/American_Airlines_logo.svg/300px-American_Airlines_logo.svg.png";
                logo.style.display = "block";
            }

            // 2. UI Transition
            document.getElementById('flight-overlay').style.opacity = '0';
            setTimeout(() => { 
                document.getElementById('flight-overlay').style.display = 'none';
                document.getElementById('status-pill').style.display = 'flex';
                document.getElementById('active-flight-text').innerText = `${flight} • GATE D20`;
            }, 600);

            // 3. Driving Route (The Blue Line)
            const query = await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${home[0]},${home[1]};${gateD20[0]},${gateD20[1]}?geometries=geojson&access_token=${mapboxgl.accessToken}`);
            const res = await query.json();
            
            map.addSource('route', { 'type': 'geojson', 'data': res.routes[0].geometry });
            map.addLayer({
                'id': 'route', 'type': 'line', 'source': 'route',
                'paint': { 'line-color': '#007AFF', 'line-width': 5, 'line-opacity': 0.7 }
            });

            // 4. THE PULSATING INDOOR GUIDE (Cyan Dot & Chevron)
            map.addSource('dot', { 'type': 'geojson', 'data': { 'type': 'Point', 'coordinates': gateD20 } });
            map.addLayer({
                'id': 'pulsing-dot', 'type': 'circle', 'source': 'dot',
                'paint': {
                    'circle-radius': 12,
                    'circle-color': '#00FBFF',
                    'circle-stroke-width': 4,
                    'circle-stroke-color': '#fff'
                }
            });

            // Animation Loop for "Palpitating" Effect
            let size = 0;
            function animate() {
                size = (size + 0.1) % 2;
                map.setPaintProperty('pulsing-dot', 'circle-radius', 10 + (size * 5));
                map.setPaintProperty('pulsing-dot', 'circle-opacity', 1 - (size / 2));
                requestAnimationFrame(animate);
            }
            animate();

            // 5. Cinematic Drop to Gate
            map.flyTo({ center: gateD20, zoom: 19, pitch: 65, bearing: -20, speed: 1.2, curve: 1.4, essential: true });
        }
    </script>
</body>
</html>
