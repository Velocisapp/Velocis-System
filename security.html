<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VELOCIS™ | MISSION CONTROL</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.1.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        :root {
            --velocity-blue: #007AFF;
            --slate-primary: #1D1D1F;
            --slate-secondary: #424245;
            --glass-white: rgba(255, 255, 255, 0.92);
            --border-light: rgba(0, 0, 0, 0.08);
            --shadow-premium: 0 4px 24px rgba(0, 0, 0, 0.06);
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #F5F5F7; color: var(--slate-primary);
            overflow: hidden;
        }

        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }

        header {
            position: absolute; top: 0; left: 0; right: 0; height: 48px;
            background: var(--glass-white); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 24px; z-index: 10;
        }

        .logo { font-weight: 700; font-size: 18px; color: var(--slate-primary); }
        .logo span { font-weight: 300; color: var(--velocity-blue); }

        .status-indicator { display: flex; align-items: center; font-size: 11px; font-weight: 600; color: var(--slate-secondary); }
        .pulse-dot { height: 6px; width: 6px; background-color: #34C759; border-radius: 50%; margin-right: 8px; animation: pulse 2s infinite; }

        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(52, 199, 89, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(52, 199, 89, 0); }
        }

        .nav-card {
            position: absolute; top: 72px; left: 24px; width: 320px;
            background: var(--glass-white); backdrop-filter: blur(15px);
            border-radius: 16px; border: 1px solid var(--border-light);
            box-shadow: var(--shadow-premium); padding: 20px; z-index: 5;
        }

        .nav-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--velocity-blue); font-weight: 700; margin-bottom: 8px; }
        .nav-objective { font-size: 16px; font-weight: 600; line-height: 1.4; }
    </style>
</head>
<body>

    <header>
        <div class="logo">VELOCIS<span>™</span></div>
        <div class="status-indicator">
            <div class="pulse-dot"></div>
            LIVE MISSION: HOME TO SEAT
        </div>
    </header>

    <div class="nav-card">
        <div class="nav-label">Current Segment</div>
        <div class="nav-objective">Terminal D Exploration</div>
        <div style="margin-top: 12px; font-size: 12px; color: var(--slate-secondary);">
            Coordinate Lock: <span id="coords" style="font-family: monospace;">Syncing...</span>
        </div>
    </div>

    <div id="map"></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoidmVsb2Npc2RldmVsb3BlciIsImEiOiJjbWtyanA4NHcxNHk0M2twcXNibXhvdnVhIn0.9sLk_qMET9czvmbYPZ9Bkg';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v11',
            center: [-80.283182, 25.797284],
            zoom: 17.5, pitch: 45, bearing: -15.4, antialias: true
        });

        map.on('load', () => {
            // 1. High-Precision 3D Layer
            map.addLayer({
                'id': '3d-buildings',
                'source': 'composite', 'source-layer': 'building',
                'filter': ['==', 'extrude', 'true'],
                'type': 'fill-extrusion',
                'paint': {
                    'fill-extrusion-color': '#D1D1D6',
                    'fill-extrusion-height': ['get', 'height'],
                    'fill-extrusion-base': ['get', 'min_height'],
                    'fill-extrusion-opacity': 0.8
                }
            });

            // 2. Terminal D North Concourse Precise Geometry
            map.addSource('terminal_d_north', {
                'type': 'geojson',
                'data': {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Polygon',
                        'coordinates': [[
                            [-80.2840, 25.7980], [-80.2815, 25.7980],
                            [-80.2815, 25.7965], [-80.2840, 25.7965],
                            [-80.2840, 25.7980]
                        ]]
                    }
                }
            });

            map.addLayer({
                'id': 'terminal-highlight',
                'type': 'fill',
                'source': 'terminal_d_north',
                'paint': { 'fill-color': '#007AFF', 'fill-opacity': 0.15 }
            });

            // 3. CUSTOM LABEL INJECTION (The Fix for Hidden Shops)
            map.addSource('velocis_labels', {
                'type': 'geojson',
                'data': {
                    'type': 'FeatureCollection',
                    'features': [
                        { 'type': 'Feature', 'properties': { 'title': 'GATE D20' }, 'geometry': { 'type': 'Point', 'coordinates': [-80.2828, 25.7977] } },
                        { 'type': 'Feature', 'properties': { 'title': 'SECURITY CHECK' }, 'geometry': { 'type': 'Point', 'coordinates': [-80.2835, 25.7972] } },
                        { 'type': 'Feature', 'properties': { 'title': 'DUTY FREE / SHOPS' }, 'geometry': { 'type': 'Point', 'coordinates': [-80.2820, 25.7970] } },
                        { 'type': 'Feature', 'properties': { 'title': 'ADMIRALS CLUB' }, 'geometry': { 'type': 'Point', 'coordinates': [-80.2825, 25.7974] } }
                    ]
                }
            });

            map.addLayer({
