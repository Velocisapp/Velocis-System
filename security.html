<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>VELOCIS™ | Sovereign Mission Controller</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js"></script>
    <style>
        :root { --velocis-cyan: #00f2ff; --matrix-dark: #05070a; --hud-bg: #0b111a; }
        body { margin: 0; padding: 0; background: var(--matrix-dark); font-family: 'Inter', -apple-system, sans-serif; color: #fff; overflow: hidden; }
        
        #map { position: absolute; top: 0; bottom: 30vh; width: 100%; border-bottom: 2px solid #1f2937; }

        /* THE MISSION HUD */
        #hud { position: absolute; bottom: 0; width: 100%; height: 30vh; background: var(--hud-bg); padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: space-between; box-shadow: 0 -10px 40px rgba(0,0,0,0.8); }
        .meta-container { display: flex; justify-content: space-between; align-items: flex-start; }
        .phase-tag { color: var(--velocis-cyan); font-size: 10px; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; }
        .airline-logo { height: 25px; filter: brightness(0) invert(1); opacity: 0.8; }
        .instruction { font-size: 24px; font-weight: 700; margin-top: 10px; line-height: 1.2; }
        .sub-instruction { color: #888; font-size: 14px; margin-top: 5px; }

        .mission-controls { display: flex; gap: 15px; margin-top: 15px; }
        button { flex: 1; padding: 15px; background: var(--velocis-cyan); color: #000; border: none; border-radius: 8px; font-weight: 900; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        button.secondary { background: transparent; border: 1px solid #333; color: #fff; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,242,255,0.3); }

        /* DELAY UI */
        .delay-alert { display: none; background: rgba(255, 165, 0, 0.1); border: 1px solid orange; color: orange; padding: 8px 12px; border-radius: 4px; font-size: 12px; margin-top: 10px; }
    </style>
</head>
<body>

<div id="map"></div>

<div id="hud">
    <div class="meta-container">
        <div>
            <div id="phase" class="phase-tag">System Initializing...</div>
            <div id="flight-id" style="font-size: 12px; color: #4b5563; margin-top: 4px;">Awaiting Handshake</div>
        </div>
        <img id="airline-logo" src="https://logodownload.org/wp-content/uploads/2020/03/american-airlines-logo-0.png" class="airline-logo">
    </div>

    <div id="main-content">
        <div id="instruction" class="instruction">Scan surroundings for Entrance D3.</div>
        <div id="sub-instruction" class="sub-instruction">MIA International Airport | Terminal North</div>
        <div id="delay-box" class="delay-alert">⚠️ DELAY DETECTED: +45m. Suggestions active.</div>
    </div>

    <div class="mission-controls">
        <button id="main-btn" onclick="engine.advanceMission()">Maneuver Recognized</button>
        <button class="secondary" onclick="engine.toggleArrivalMode()">Switch to Arrival</button>
    </div>
</div>

<script>
    /* VELOCIS™ MISSION ENGINE v3.0
       Integrated with Mapbox (Spatial) and Aviationstack (Logic)
    */
    class VelocisEngine {
        constructor() {
            this.step = 0;
            this.isArrival = false;
            this.map = null;
            this.initMap();
        }

        initMap() {
            mapboxgl.accessToken = 'YOUR_MAPBOX_TOKEN_HERE';
            this.map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/navigation-night-v1', // High-contrast Matrix
                center: [-80.2831, 25.7955], // MIA Concourse D Entry
                zoom: 16,
                pitch: 60,
                bearing: -20
            });
        }

        async fetchAviationData(flightIcao) {
            // This is the Handshake we discussed
            // const response = await fetch(`https://api.aviationstack.com/v1/flights?access_key=YOUR_KEY&flight_icao=${flightIcao}`);
            // const data = await response.json();
            
            // Mocking the successful Handshake for MIA D32 Mission
            return {
                gate: "D32",
                terminal: "North",
                delay: 45,
                status: "scheduled"
            };
        }

        advanceMission() {
            const departureNodes = [
                { id: "node-kiosk", text: "Proceed to Counters 22-34.", sub: "Follow Zone D Signage", coords: [-80.2855, 25.7962], zoom: 17.5 },
                { id: "node-tsa", text: "Clear Security Checkpoint D.", sub: "Standard and TSA PreCheck active", coords: [-80.2872, 25.7968], zoom: 18 },
                { id: "node-gate", text: "Take Skytrain to Station 3.", sub: "Final Objective: Gate D32", coords: [-80.2915, 25.7981], zoom: 18.5 }
            ];

            if (this.step < departureNodes.length) {
                const mission = departureNodes[this.step];
                this.updateUI("DEPARTURE MISSION", mission.text, mission.sub);
                this.updateMap(mission.coords, mission.zoom);
                this.step++;
            }
        }

        toggleArrivalMode() {
            this.isArrival = true;
            this.updateUI("ARRIVAL MISSION", "Landed: Proceed to Carousel 12.", "Follow 'Baggage Claim' to Exit Gate 4");
            this.updateMap([-80.2850, 25.7940], 17); // Shifts to Lower Level Arrival Hub
            document.getElementById('delay-box').style.display = 'none';
        }

        updateUI(phase, main, sub) {
            document.getElementById('phase').innerText = phase;
            document.getElementById('instruction').innerText = main;
            document.getElementById('sub-instruction').innerText = sub;
        }

        updateMap(coords, zoom) {
            this.map.flyTo({ center: coords, zoom: zoom, speed: 0.8, curve: 1 });
            // Anchor the Sovereign Pin
            new mapboxgl.Marker({ color: "#00f2ff" }).setLngLat(coords).addTo(this.map);
        }
    }

    const engine = new VelocisEngine();
</script>
</body>
</html>
